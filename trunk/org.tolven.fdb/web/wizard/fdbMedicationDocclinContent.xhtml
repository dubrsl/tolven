<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"   
      xmlns:wiz="http://www.tolven.org/jsf/wizard"
      xmlns:trim="http://www.tolven.org/jsf/trim">
<head>
    <title>FDB medication entry template</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <ui:composition>
		<ui:include src="/wizard/fdbDrugsPopup.xhtml">
			<ui:param name="status" value="#{status}" />
		</ui:include>
		<c:set var="hasUnsavedMedication" value="false"/>
		<div class="widget">
			<table width="100%" cellpadding="0" cellspacing="0" border="0">
				<thead>
					<tr>
						<th style="text-align: center;width: 16%;"><b>Medications</b></th>
						<th style="text-align: center;width: 10%;"><b>Route</b></th>
						<th style="text-align: center;width: 10%;"><b>Frequency</b></th>
						<th style="text-align: center;width: 15%;"><b>Administration Instructions</b></th>
						<th style="text-align: center;width: 15%;"><b>Comments</b></th>
						<th style="text-align: center;width: 12%;"><b>Start Date</b></th>
						<th style="text-align: center;width: 12%;"><b>End Date</b></th>
						<th style="text-align: center;width: 10%;"></th>
					</tr>
				</thead>
				<tbody>
				<c:forEach var="med" items="#{trim.trim.act.relationshipsList[trim.trim.act.computes[0].property['arName']]}" varStatus="widgetIndex">
					<c:set var="class" value="odd"/>
					<c:if test="#{(widgetIndex.index%2)==1}"><c:set var="class" value="even"/></c:if>
					<c:if test="#{med.enabled == true and ((status == 'medicationsTaken' and med.act.statusCode == 'COMPLETED') or (status != 'medicationsTaken' and med.act.statusCode != 'COMPLETED'))}">
					
					<tr id="#{menu.elementLabel}savedOrder#{status}#{widgetIndex.index}" class="#{class}">
						<td>#{med.act.participations[0].role.player.code}</td>
						<td>
							#{med.act.substanceAdministration.routeCode.value.displayName}
						</td>
						<td>
							#{med.act.relationship['frequency'].act.observation.value.CE.displayName}						
						</td>
						<td>#{med.act.relationship['instructions'].act.text.originalText}</td>
						<td>#{med.act.relationship['comments'].act.text.originalText}</td>
						<td><trim:TSNew value="#{med.act.effectiveTime.IVLTS.low.TS}" dateStyle="short" readonly="true"/></td>	
						<td><trim:TSNew value="#{med.act.effectiveTime.IVLTS.high.TS}" dateStyle="short"  readonly="true" style=""/></td>
						<td style="width: 7%;" nowrap="nowrap">
							<img onclick="{$('#{menu.elementLabel}savedOrder#{status}#{widgetIndex.index}').toggle();$('#{menu.elementLabel}editableOrder#{status}#{widgetIndex.index}').toggle();}" alt="Edit" src="../images/edit.jpg" style="cursor:pointer;" title="Edit" height="22" width="22"></img>
							<img onclick="removeFdbDrug('#{menu.elementLabel}','#{widgetIndex.index+1}','#{status}');" alt="Remove" src="../images/delete.gif" style="cursor:pointer;" title="Remove" height="20" width="20"></img>
							
						</td>
					</tr>
					<tr id="#{menu.elementLabel}editableOrder#{status}#{widgetIndex.index}" class="#{class}" style="display:none">
						<td>#{med.act.participations[0].role.player.code}
							<h:inputHidden id="saveDrug#{status}#{widgetIndex.index}" value="#{med.enableRelationship}"/>
						</td>
						<td style="text-align: center;width: 10%;">
							<trim:valueSetMenu id="route#{status}#{widgetIndex.index}"  slot="#{med.act.substanceAdministration.routeCode}" readonly="false" style="width:95%;"/>
						</td>
						<td  style="text-align: center;width: 10%;">
							<trim:valueSetMenu id="frequency#{status}#{widgetIndex.index}"  slot="#{med.act.relationship['frequency'].act.observation.value}" readonly="false" style="width:95%;"/>
						</td>
						<td style="text-align: center;width: 15%;">
							<h:inputTextarea id="instr#{status}#{widgetIndex.index}" value="#{med.act.relationship['instructions'].act.text.originalText}"/>
						</td>
						<td style="text-align: center;width: 15%;">
							<h:inputTextarea id="comment#{status}#{widgetIndex.index}" value="#{med.act.relationship['comments'].act.text.originalText}"/>
						</td>
						<td style="text-align: center;width: 12%;">
							<trim:TSNew id="start#{status}#{widgetIndex.index}" value="#{med.act.effectiveTime.IVLTS.low.TS}" dateStyle="short" style="width:68%;" readonly="false" />
						</td>	
						<td style="text-align: center;width: 12%;">
							<trim:TSNew id="end#{status}#{widgetIndex.index}" value="#{med.act.effectiveTime.IVLTS.high.TS}" dateStyle="short" style="width:68%;" readonly="false"/>
						</td>
						<td style="" align="center" valign="middle">
							<img onclick="setEnableAct('#{menu.elementLabel}','saveDrug#{status}#{widgetIndex.index}',true)" src="../images/save.gif" alt="Save" style="cursor:pointer;" title="Save" height="22" width="22">
								</img>
							<img onclick="removeFdbDrug('#{menu.elementLabel}','#{med.sequenceNumber}','#{status}');" alt="Remove" src="../images/delete.gif" style="cursor:pointer;" title="Remove" height="20" width="20"></img>						
						</td>
					</tr>
					</c:if>
					<c:if test="#{med.enabled == false and ((status == 'medicationsTaken' and med.act.statusCode == 'COMPLETED') or (status != 'medicationsTaken' and med.act.statusCode != 'COMPLETED'))}"> <!-- problems not saved -->
						<c:set var="hasUnsavedMedication" value="true"/>
						<tr class="#{class}">
							<td>#{med.act.participations[0].role.player.code}
							<h:inputHidden id="saveDrug#{status}#{widgetIndex.index}" value="#{med.enableRelationship}"/>
							</td>
							<td style="text-align: center;width: 10%;">
								<trim:valueSetMenu id="route#{status}#{widgetIndex.index}"  slot="#{med.act.substanceAdministration.routeCode}" readonly="false" style="width:95%;"/>
							</td>
							<td style="text-align: center;width: 10%;">
								<trim:valueSetMenu id="frequency#{status}#{widgetIndex.index}"  slot="#{med.act.relationship['frequency'].act.observation.value}" readonly="false" style="width:95%;"/>
							</td>
							<td style="text-align: center;width: 15%;">
								<h:inputTextarea id="instr#{status}#{widgetIndex.index}" value="#{med.act.relationship['instructions'].act.text.originalText}"/>
							</td>
							<td style="text-align: center;width: 15%;">
								<h:inputTextarea id="comment#{status}#{widgetIndex.index}" value="#{med.act.relationship['comments'].act.text.originalText}"/>
							</td>
							<td style="text-align: center;width: 12%;">
								<trim:TSNew id="start#{status}#{widgetIndex.index}" value="#{med.act.effectiveTime.IVLTS.low.TS}" dateStyle="short" style="width:68%;" readonly="false"/>
							</td>	
							<td style="text-align: center;width: 12%;">
								<trim:TSNew id="end#{status}#{widgetIndex.index}" value="#{med.act.effectiveTime.IVLTS.high.TS}" dateStyle="short" style="width:68%;" readonly="false"/>
							</td>	
							<td style="" align="center" valign="middle">
								<img onclick="setEnableAct('#{menu.elementLabel}','saveDrug#{status}#{widgetIndex.index}',true)" src="../images/save.gif" alt="Save" style="cursor:pointer;" title="Save" height="22" width="22">
									</img>
								<img onclick="removeFdbDrug('#{menu.elementLabel}','#{med.sequenceNumber}','#{status}');" alt="Remove" src="../images/delete.gif" style="cursor:pointer;" title="Remove" height="20" width="20"></img>								
							</td>
						</tr>		
					</c:if>
				</c:forEach>	
			</tbody>			
			</table>
		</div>
		<c:if test="#{hasUnsavedMedication == 'true'}">
			<h:inputHidden id="preProcessStepParams" value="2,confirmDeleteUnsavedMedications;3,confirmDeleteUnsavedMedications"/>
		</c:if>
		<c:if test="#{hasUnsavedMedication == 'false'}">
		<div id="#{menu.elementLabel}:addProcAnchor" class="widgetAction">
			<a href="javascript:wizAddMedicationWidget('#{status}medicationFromFDBPopUP','#{menu.elementLabel}','#{menu.element}','#{status}','addFdbDrug');">Add medication</a>	
		</div>
		</c:if>
		<div id="msgMedication" style="color: red;font-weight: bold;text-align: center;" ></div>
	</ui:composition>	
</body>
</html>