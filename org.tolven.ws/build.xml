<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="deploy-to-local-repository" name="org.tolven.ws">
	<!-- 
	Build file for org.tolven.config.rsa 
	-->
	<import file="../plugin/buildImport.xml" />

	<property name="buildFolder" value="build" />
	<!-- 
	Source code will be included in the devLib jar file if true. Otherwise, source code
	known to this build script (in the sources folder) will not be added to the plugin.
	Source code may be published in devLib for several reasons: 1) remote-debugging, 
	2) it meets the obligation to make source code available with most open-source licenses,
	3) Provides a way to verify that a particular plugin version has a particular 
	source-code change. But this is not a substitute for source-code management tools.
	 -->
	<property name="includeSourceInDevLib" value="true" />

	<!-- 
	The "build-plugin" target builds one or more sections, each section consisting of a source directory and
	any other files needed by the manifest/tolven-plugin.xml. You are free to remove any sections that you don't use
	and add sections if needed. In any case, the folders (sections) mentioned here should correspond to the filters
	mentioned in the manifest.
	-->
	<target name="build-plugin" depends="init" description="Build all sections of this plugin">
		<zip destfile="${zipFileName}">
			<!-- Add Manifest section -->
			<zipfileset dir="manifest" />
		</zip>
		<!-- Begin list of sections to build. Each section is added to the plugin zip file. -->
		<antcall target="buildSection">
			<param name="section" value="web"/>
		</antcall>
		<!-- End of list of sections to build -->
		<!-- Add DevLib.jar to plugin zip -->
		<jar destfile="build/tolvenWS.war">
			<manifest>
				<attribute name="Built-By" value="Tolven Healthcare Innovations"/>
				<attribute name="Implementation-Version" value="${tolven.impl.version}" />
			</manifest>
			<zipfileset dir="${buildFolder}/web/classes" includes="**/*.class" prefix="WEB-INF/classes" />
			<zipfileset dir=".">
				<include name="WEB-INF/**" />
				<exclude name="**/*.wsdl" />
			</zipfileset>
		</jar>
		<zip destfile="${zipFileName}" update="true">
			<zipfileset dir="${buildFolder}">
				<include name="devLib.jar" />
				<include name="tolvenWS.war" />
			</zipfileset>
		</zip>
	</target>

	<!-- Custom overrides in ant-build.properties -->
	<property file="../tolven/resources/ant-build.properties"/>
	<!-- Anything not declared in ant-build.properties, we grab from the default -->
	<property file="../tolven/resources/ant-build-default.properties"/>

	<path id="jaxws.classpath">
		<fileset dir="${tolven.location}/lib/metro">
			<include name="*.jar"/>
		</fileset>
	</path>

	<target name="javadoc" description="Generate Javadoc">
		<javadoc access="public" author="true" destdir="build/doc" doctitle="Tolven WEB" 
			packagenames="*"
			classpathref="project.classpath" 
			source="1.6" sourcepath="web/source" 
			splitindex="true" use="true" version="true"
			encoding="UTF-8"  docencoding="UTF-8"/>
	</target>
	<target name="unit-test" depends="build-plugin">
		<junit fork="yes" showoutput="true" printsummary="withOutAndErr" >
			<formatter type="plain" usefile="false" />
			<classpath refid="project.classpath"/>
			<batchtest >
				<fileset dir="web/source">
					<include name="test/**/*.java"/>
				</fileset>
			</batchtest>
		</junit>
	</target>
	<!-- Generate WebService java files. These are checked into CVS, so this is not required to be run during every build...only for changes -->
	<target name="generate-webservices" depends="clean,build-plugin" description="Generate WebServices">
		<delete>
			<fileset dir="web/source/org/tolven/ws">
				<include name="**/jaxws/*"/>
			</fileset>
		</delete>
		<apt srcdir="web/source"
			destdir="build"
			classpathref="project.classpath"
			debug="on"
			compile="true"
			preprocessdir="web/source">
		</apt>
	</target>
</project>
